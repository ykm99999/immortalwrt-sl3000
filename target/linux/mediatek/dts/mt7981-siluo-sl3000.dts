/dts-v1/;

#include "mt7981.dtsi"

/ {
    model = "Siluo SL-3000";
    compatible = "siluo,sl3000", "mediatek,mt7981";

    chosen {
        bootargs = "console=ttyS0,115200n8";
    };

    /* 1GB DDR4 内存 */
    memory {
        reg = <0x40000000 0x40000000>; /* 1GB */
    };

    aliases {
        led-boot = &led_status;
        led-failsafe = &led_status;
        led-running = &led_status;
        led-upgrade = &led_status;
        ethernet0 = &gmac0;
    };

    leds {
        compatible = "gpio-leds";

        led_status: status {
            label = "sl3000:green:status";
            gpios = <&pio 12 GPIO_ACTIVE_HIGH>;
        };

        wan_led: wan {
            label = "sl3000:blue:wan";
            gpios = <&pio 13 GPIO_ACTIVE_HIGH>;
        };

        wifi_led: wifi {
            label = "sl3000:green:wifi";
            gpios = <&pio 14 GPIO_ACTIVE_HIGH>;
        };
    };

    keys {
        compatible = "gpio-keys";

        reset {
            label = "reset";
            gpios = <&pio 15 GPIO_ACTIVE_LOW>;
            linux,code = <KEY_RESTART>;
        };

        wps {
            label = "wps";
            gpios = <&pio 16 GPIO_ACTIVE_LOW>;
            linux,code = <KEY_WPS_BUTTON>;
        };
    };
};

/* 千兆以太网 */
&gmac0 {
    status = "okay";
    phy-mode = "sgmii";
    /* 如果有外部 PHY，请改为 phy-handle 指向对应节点 */
    fixed-link {
        speed = <1000>;
        full-duplex;
    };
};

/* WiFi6 AX3000 */
&wifi {
    status = "okay";
    /* 建议增加 EEPROM 校准数据引用 */
    mediatek,eeprom = <&factory 0x0000>;
};

/* SPI-NOR 32MB */
&spi0 {
    status = "okay";

    flash@0 {
        compatible = "jedec,spi-nor";
        reg = <0>;
        spi-max-frequency = <50000000>;

        partitions {
            compatible = "fixed-partitions";
            #address-cells = <1>;
            #size-cells = <1>;

            partition@0 {
                label = "bootloader";
                reg = <0x00000000 0x00100000>; /* 1MB */
                read-only;
            };

            partition@100000 {
                label = "config";
                reg = <0x00100000 0x00100000>; /* 1MB */
            };

            partition@200000 {
                label = "factory";
                reg = <0x00200000 0x00100000>; /* 1MB */
            };

            partition@300000 {
                label = "reserved";
                reg = <0x00300000 0x01D00000>; /* 29MB */
            };
        };
    };
};

/* eMMC 128GB */
&mmc0 {
    status = "okay";
    bus-width = <8>;
    non-removable;
    cap-mmc-highspeed;
    cap-mmc-hs200;
    cap-mmc-hs400;
    mmc-hs400-1_8v;
    vmmc-supply = <&mt7981_regulator>;
    vqmmc-supply = <&mt7981_regulator>;

    partitions {
        compatible = "fixed-partitions";
        #address-cells = <1>;
        #size-cells = <1>;

        partition@0 {
            label = "firmware";
            reg = <0x00000000 0x700000000>; /* 112GB */
        };

        partition@700000000 {
            label = "userdata";
            reg = <0x700000000 0x100000000>; /* 16GB */
        };
    };
};
