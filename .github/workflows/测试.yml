name: 司洛SL-3000 软件包编译 (通用版)

on:
  workflow_dispatch:
    inputs:
      target_device:
        description: '目标设备'
        required: true
        default: 'mediatek/mt7981'
        type: choice
        options:
        - mediatek/mt7981
        - mediatek/mt7986

env:
  REPO_URL: https://github.com/padavanonly/immortalwrt-mt798x-24.10
  REPO_BRANCH: 2410

jobs:
  build-packages:
    runs-on: ubuntu-22.04
    
    steps:
    - name: Checkout
      uses: actions/checkout@v4

    - name: 克隆源码
      run: |
        git clone --depth=1 --branch $REPO_BRANCH $REPO_URL openwrt

    - name: 检测可用设备
      run: |
        cd openwrt
        echo "=== 可用的MT798x设备 ==="
        find target/linux/mediatek/mt798* -name "*.mk" | grep image | head -20
        
        echo "=== 设备配置示例 ==="
        for file in target/linux/mediatek/mt798*/image/*.mk; do
          if [ -f "$file" ]; then
            echo "文件: $file"
            grep "DEVICE_" "$file" | head -5
            echo "---"
          fi
        done
